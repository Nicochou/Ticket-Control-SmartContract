{"ast":null,"code":"'use strict';\n\nvar _regenerator = require('babel-runtime/regenerator');\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _promise = require('babel-runtime/core-js/promise');\n\nvar _promise2 = _interopRequireDefault(_promise);\n\nvar _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');\n\nvar _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);\n\nvar _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require('babel-runtime/helpers/createClass');\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require('babel-runtime/helpers/inherits');\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n} // const EthQuery = require('ethjs-query')\n\n\nvar EthQuery = require('eth-query');\n\nvar AsyncEventEmitter = require('async-eventemitter');\n\nvar pify = require('pify');\n\nvar hexUtils = require('./hexUtils');\n\nvar incrementHexNumber = hexUtils.incrementHexNumber;\n\nvar RpcBlockTracker = function (_AsyncEventEmitter) {\n  (0, _inherits3.default)(RpcBlockTracker, _AsyncEventEmitter);\n\n  function RpcBlockTracker() {\n    var opts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    (0, _classCallCheck3.default)(this, RpcBlockTracker);\n\n    var _this = (0, _possibleConstructorReturn3.default)(this, (RpcBlockTracker.__proto__ || (0, _getPrototypeOf2.default)(RpcBlockTracker)).call(this));\n\n    if (!opts.provider) throw new Error('RpcBlockTracker - no provider specified.');\n    _this._provider = opts.provider;\n    _this._query = new EthQuery(opts.provider); // config\n\n    _this._pollingInterval = opts.pollingInterval || 4e3; // 4 sec\n\n    _this._syncingTimeout = opts.syncingTimeout || 60 * 1e3; // 1 min\n    // state\n\n    _this._trackingBlock = null;\n    _this._trackingBlockTimestamp = null;\n    _this._currentBlock = null;\n    _this._isRunning = false; // bind methods for cleaner syntax later\n\n    _this.emit = _this.emit.bind(_this);\n    _this._performSync = _this._performSync.bind(_this);\n    _this._handleNewBlockNotification = _this._handleNewBlockNotification.bind(_this);\n    return _this;\n  }\n\n  (0, _createClass3.default)(RpcBlockTracker, [{\n    key: 'getTrackingBlock',\n    value: function getTrackingBlock() {\n      return this._trackingBlock;\n    }\n  }, {\n    key: 'getCurrentBlock',\n    value: function getCurrentBlock() {\n      return this._currentBlock;\n    }\n  }, {\n    key: 'awaitCurrentBlock',\n    value: function () {\n      var _ref = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee() {\n        var _this2 = this;\n\n        return _regenerator2.default.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!this._currentBlock) {\n                  _context.next = 2;\n                  break;\n                }\n\n                return _context.abrupt('return', this._currentBlock);\n\n              case 2:\n                _context.next = 4;\n                return new _promise2.default(function (resolve) {\n                  return _this2.once('sync', resolve);\n                });\n\n              case 4:\n                return _context.abrupt('return', this._currentBlock);\n\n              case 5:\n              case 'end':\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function awaitCurrentBlock() {\n        return _ref.apply(this, arguments);\n      }\n\n      return awaitCurrentBlock;\n    }()\n  }, {\n    key: 'start',\n    value: function () {\n      var _ref2 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee2() {\n        var opts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n        return _regenerator2.default.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                if (!this._isRunning) {\n                  _context2.next = 2;\n                  break;\n                }\n\n                return _context2.abrupt('return');\n\n              case 2:\n                this._isRunning = true; // if this._currentBlock\n\n                if (!opts.fromBlock) {\n                  _context2.next = 12;\n                  break;\n                }\n\n                _context2.t0 = this;\n                _context2.next = 7;\n                return this._fetchBlockByNumber(opts.fromBlock);\n\n              case 7:\n                _context2.t1 = _context2.sent;\n                _context2.next = 10;\n                return _context2.t0._setTrackingBlock.call(_context2.t0, _context2.t1);\n\n              case 10:\n                _context2.next = 18;\n                break;\n\n              case 12:\n                _context2.t2 = this;\n                _context2.next = 15;\n                return this._fetchLatestBlock();\n\n              case 15:\n                _context2.t3 = _context2.sent;\n                _context2.next = 18;\n                return _context2.t2._setTrackingBlock.call(_context2.t2, _context2.t3);\n\n              case 18:\n                if (!this._provider.on) {\n                  _context2.next = 23;\n                  break;\n                }\n\n                _context2.next = 21;\n                return this._initSubscription();\n\n              case 21:\n                _context2.next = 24;\n                break;\n\n              case 23:\n                this._performSync().catch(function (err) {\n                  if (err) console.error(err);\n                });\n\n              case 24:\n              case 'end':\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function start() {\n        return _ref2.apply(this, arguments);\n      }\n\n      return start;\n    }()\n  }, {\n    key: 'stop',\n    value: function () {\n      var _ref3 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee3() {\n        return _regenerator2.default.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                this._isRunning = false;\n\n                if (!this._provider.on) {\n                  _context3.next = 4;\n                  break;\n                }\n\n                _context3.next = 4;\n                return this._removeSubscription();\n\n              case 4:\n              case 'end':\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function stop() {\n        return _ref3.apply(this, arguments);\n      }\n\n      return stop;\n    }() //\n    // private\n    //\n\n  }, {\n    key: '_setTrackingBlock',\n    value: function () {\n      var _ref4 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee4(newBlock) {\n        var previous, now;\n        return _regenerator2.default.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                if (!(this._trackingBlock && this._trackingBlock.hash === newBlock.hash)) {\n                  _context4.next = 2;\n                  break;\n                }\n\n                return _context4.abrupt('return');\n\n              case 2:\n                // check for large timestamp lapse\n                previous = this._trackingBlockTimestamp;\n                now = Date.now(); // check for desynchronization (computer sleep or no internet)\n\n                if (!(previous && now - previous > this._syncingTimeout)) {\n                  _context4.next = 10;\n                  break;\n                }\n\n                this._trackingBlockTimestamp = null;\n                _context4.next = 8;\n                return this._warpToLatest();\n\n              case 8:\n                _context4.next = 14;\n                break;\n\n              case 10:\n                this._trackingBlock = newBlock;\n                this._trackingBlockTimestamp = now;\n                _context4.next = 14;\n                return pify(this.emit)('block', newBlock);\n\n              case 14:\n              case 'end':\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      function _setTrackingBlock(_x3) {\n        return _ref4.apply(this, arguments);\n      }\n\n      return _setTrackingBlock;\n    }()\n  }, {\n    key: '_setCurrentBlock',\n    value: function () {\n      var _ref5 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee5(newBlock) {\n        var oldBlock;\n        return _regenerator2.default.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                if (!(this._currentBlock && this._currentBlock.hash === newBlock.hash)) {\n                  _context5.next = 2;\n                  break;\n                }\n\n                return _context5.abrupt('return');\n\n              case 2:\n                oldBlock = this._currentBlock;\n                this._currentBlock = newBlock;\n                _context5.next = 6;\n                return pify(this.emit)('latest', newBlock);\n\n              case 6:\n                _context5.next = 8;\n                return pify(this.emit)('sync', {\n                  newBlock: newBlock,\n                  oldBlock: oldBlock\n                });\n\n              case 8:\n              case 'end':\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this);\n      }));\n\n      function _setCurrentBlock(_x4) {\n        return _ref5.apply(this, arguments);\n      }\n\n      return _setCurrentBlock;\n    }()\n  }, {\n    key: '_warpToLatest',\n    value: function () {\n      var _ref6 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee6() {\n        return _regenerator2.default.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                _context6.t0 = this;\n                _context6.next = 3;\n                return this._fetchLatestBlock();\n\n              case 3:\n                _context6.t1 = _context6.sent;\n                _context6.next = 6;\n                return _context6.t0._setTrackingBlock.call(_context6.t0, _context6.t1);\n\n              case 6:\n              case 'end':\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this);\n      }));\n\n      function _warpToLatest() {\n        return _ref6.apply(this, arguments);\n      }\n\n      return _warpToLatest;\n    }()\n  }, {\n    key: '_pollForNextBlock',\n    value: function () {\n      var _ref7 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee7() {\n        var _this3 = this;\n\n        return _regenerator2.default.wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                setTimeout(function () {\n                  return _this3._performSync();\n                }, this._pollingInterval);\n\n              case 1:\n              case 'end':\n                return _context7.stop();\n            }\n          }\n        }, _callee7, this);\n      }));\n\n      function _pollForNextBlock() {\n        return _ref7.apply(this, arguments);\n      }\n\n      return _pollForNextBlock;\n    }()\n  }, {\n    key: '_performSync',\n    value: function () {\n      var _ref8 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee8() {\n        var trackingBlock, nextNumber, newBlock;\n        return _regenerator2.default.wrap(function _callee8$(_context8) {\n          while (1) {\n            switch (_context8.prev = _context8.next) {\n              case 0:\n                if (this._isRunning) {\n                  _context8.next = 2;\n                  break;\n                }\n\n                return _context8.abrupt('return');\n\n              case 2:\n                trackingBlock = this.getTrackingBlock();\n\n                if (trackingBlock) {\n                  _context8.next = 5;\n                  break;\n                }\n\n                throw new Error('RpcBlockTracker - tracking block is missing');\n\n              case 5:\n                nextNumber = incrementHexNumber(trackingBlock.number);\n                _context8.prev = 6;\n                _context8.next = 9;\n                return this._fetchBlockByNumber(nextNumber);\n\n              case 9:\n                newBlock = _context8.sent;\n\n                if (!newBlock) {\n                  _context8.next = 16;\n                  break;\n                }\n\n                _context8.next = 13;\n                return this._setTrackingBlock(newBlock);\n\n              case 13:\n                // ask for next block\n                this._performSync();\n\n                _context8.next = 19;\n                break;\n\n              case 16:\n                _context8.next = 18;\n                return this._setCurrentBlock(trackingBlock);\n\n              case 18:\n                // setup poll for next block\n                this._pollForNextBlock();\n\n              case 19:\n                _context8.next = 31;\n                break;\n\n              case 21:\n                _context8.prev = 21;\n                _context8.t0 = _context8['catch'](6);\n\n                if (!(_context8.t0.message.includes('index out of range') || _context8.t0.message.includes(\"Couldn't find block by reference\"))) {\n                  _context8.next = 29;\n                  break;\n                }\n\n                _context8.next = 26;\n                return this._setCurrentBlock(trackingBlock);\n\n              case 26:\n                // setup poll for next block\n                this._pollForNextBlock();\n\n                _context8.next = 31;\n                break;\n\n              case 29:\n                console.error(_context8.t0);\n\n                this._pollForNextBlock();\n\n              case 31:\n              case 'end':\n                return _context8.stop();\n            }\n          }\n        }, _callee8, this, [[6, 21]]);\n      }));\n\n      function _performSync() {\n        return _ref8.apply(this, arguments);\n      }\n\n      return _performSync;\n    }()\n  }, {\n    key: '_handleNewBlockNotification',\n    value: function () {\n      var _ref9 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee9(err, notification) {\n        return _regenerator2.default.wrap(function _callee9$(_context9) {\n          while (1) {\n            switch (_context9.prev = _context9.next) {\n              case 0:\n                if (!(notification.id != this._subscriptionId)) {\n                  _context9.next = 2;\n                  break;\n                }\n\n                return _context9.abrupt('return');\n\n              case 2:\n                if (!err) {\n                  _context9.next = 7;\n                  break;\n                }\n\n                _context9.next = 5;\n                return pify(this.emit)('error', err);\n\n              case 5:\n                _context9.next = 7;\n                return this._removeSubscription();\n\n              case 7:\n                _context9.t0 = this;\n                _context9.next = 10;\n                return this._fetchBlockByNumber(notification.result.number);\n\n              case 10:\n                _context9.t1 = _context9.sent;\n                _context9.next = 13;\n                return _context9.t0._setTrackingBlock.call(_context9.t0, _context9.t1);\n\n              case 13:\n              case 'end':\n                return _context9.stop();\n            }\n          }\n        }, _callee9, this);\n      }));\n\n      function _handleNewBlockNotification(_x5, _x6) {\n        return _ref9.apply(this, arguments);\n      }\n\n      return _handleNewBlockNotification;\n    }()\n  }, {\n    key: '_initSubscription',\n    value: function () {\n      var _ref10 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee10() {\n        var result;\n        return _regenerator2.default.wrap(function _callee10$(_context10) {\n          while (1) {\n            switch (_context10.prev = _context10.next) {\n              case 0:\n                this._provider.on('data', this._handleNewBlockNotification);\n\n                _context10.next = 3;\n                return pify(this._provider.sendAsync || this._provider.send)({\n                  jsonrpc: '2.0',\n                  id: new Date().getTime(),\n                  method: 'eth_subscribe',\n                  params: ['newHeads']\n                });\n\n              case 3:\n                result = _context10.sent;\n                this._subscriptionId = result.result;\n\n              case 5:\n              case 'end':\n                return _context10.stop();\n            }\n          }\n        }, _callee10, this);\n      }));\n\n      function _initSubscription() {\n        return _ref10.apply(this, arguments);\n      }\n\n      return _initSubscription;\n    }()\n  }, {\n    key: '_removeSubscription',\n    value: function () {\n      var _ref11 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee11() {\n        return _regenerator2.default.wrap(function _callee11$(_context11) {\n          while (1) {\n            switch (_context11.prev = _context11.next) {\n              case 0:\n                if (this._subscriptionId) {\n                  _context11.next = 2;\n                  break;\n                }\n\n                throw new Error(\"Not subscribed.\");\n\n              case 2:\n                this._provider.removeListener('data', this._handleNewBlockNotification);\n\n                _context11.next = 5;\n                return pify(this._provider.sendAsync || this._provider.send)({\n                  jsonrpc: '2.0',\n                  id: new Date().getTime(),\n                  method: 'eth_unsubscribe',\n                  params: [this._subscriptionId]\n                });\n\n              case 5:\n                delete this._subscriptionId;\n\n              case 6:\n              case 'end':\n                return _context11.stop();\n            }\n          }\n        }, _callee11, this);\n      }));\n\n      function _removeSubscription() {\n        return _ref11.apply(this, arguments);\n      }\n\n      return _removeSubscription;\n    }()\n  }, {\n    key: '_fetchLatestBlock',\n    value: function _fetchLatestBlock() {\n      return pify(this._query.getBlockByNumber).call(this._query, 'latest', true);\n    }\n  }, {\n    key: '_fetchBlockByNumber',\n    value: function _fetchBlockByNumber(hexNumber) {\n      var cleanHex = hexUtils.formatHex(hexNumber);\n      return pify(this._query.getBlockByNumber).call(this._query, cleanHex, true);\n    }\n  }]);\n  return RpcBlockTracker;\n}(AsyncEventEmitter);\n\nmodule.exports = RpcBlockTracker; // ├─ difficulty: 0x2892ddca\n// ├─ extraData: 0xd983010507846765746887676f312e372e348777696e646f7773\n// ├─ gasLimit: 0x47e7c4\n// ├─ gasUsed: 0x6384\n// ├─ hash: 0xf60903687b1559b9c80f2d935b4c4f468ad95c3076928c432ec34f2ef3d4eec9\n// ├─ logsBloom: 0x00000000000000000000000000000000000000000000000000000000000020000000000000000000000000040000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000\n// ├─ miner: 0x01711853335f857442ef6f349b2467c531731318\n// ├─ mixHash: 0xf0d9bec999600eec92e8e4da8fc1182e357468c9ed2f849aa17e0e900412b352\n// ├─ nonce: 0xd556d5a5504198e4\n// ├─ number: 0x72ac8\n// ├─ parentHash: 0xf5239c3ce1085194521435a5052494c02bbb1002b019684dcf368490ea6208e5\n// ├─ receiptsRoot: 0x78c6f8236094b392bcc43b47b0dc1ce93ecd2875bfb5e4e4c3431e5af698ff99\n// ├─ sha3Uncles: 0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347\n// ├─ size: 0x2ad\n// ├─ stateRoot: 0x0554f145c481df2fa02ecd2da17071672740c3aa948c896f1465e6772f741ac6\n// ├─ timestamp: 0x58955844\n// ├─ totalDifficulty: 0x751d0dfa03c1\n// ├─ transactions\n// │  └─ 0\n// │     ├─ blockHash: 0xf60903687b1559b9c80f2d935b4c4f468ad95c3076928c432ec34f2ef3d4eec9\n// │     ├─ blockNumber: 0x72ac8\n// │     ├─ from: 0x201354729f8d0f8b64e9a0c353c672c6a66b3857\n// │     ├─ gas: 0x15f90\n// │     ├─ gasPrice: 0x4a817c800\n// │     ├─ hash: 0xd5a15d7c2449150db4f74f42a6ca0702150a24c46c5b406a7e1b3e44908ef44d\n// │     ├─ input: 0xe1fa8e849bc10d87fb03c6b0603b05a3e29043c7e0b7c927119576a4bec457e96c7d7cde\n// │     ├─ nonce: 0x323e\n// │     ├─ to: 0xd10e3be2bc8f959bc8c41cf65f60de721cf89adf\n// │     ├─ transactionIndex: 0x0\n// │     ├─ value: 0x0\n// │     ├─ v: 0x29\n// │     ├─ r: 0xf35f8ab241e6bb3ccaffd21b268dbfc7fcb5df1c1fb83ee5306207e4a1a3e954\n// │     └─ s: 0x1610cdac2782c91065fd43584cd8974f7f3b4e6d46a2aafe7b101788285bf3f2\n// ├─ transactionsRoot: 0xb090c32d840dec1e9752719f21bbae4a73e58333aecb89bc3b8ed559fb2712a3\n// └─ uncles","map":{"version":3,"sources":["D:/Projet/ecole_etna/final-project-feamcor/bileto/client/node_modules/eth-block-tracker-es5/dist/index.js"],"names":["_regenerator","require","_regenerator2","_interopRequireDefault","_promise","_promise2","_asyncToGenerator2","_asyncToGenerator3","_getPrototypeOf","_getPrototypeOf2","_classCallCheck2","_classCallCheck3","_createClass2","_createClass3","_possibleConstructorReturn2","_possibleConstructorReturn3","_inherits2","_inherits3","obj","__esModule","default","EthQuery","AsyncEventEmitter","pify","hexUtils","incrementHexNumber","RpcBlockTracker","_AsyncEventEmitter","opts","arguments","length","undefined","_this","__proto__","call","provider","Error","_provider","_query","_pollingInterval","pollingInterval","_syncingTimeout","syncingTimeout","_trackingBlock","_trackingBlockTimestamp","_currentBlock","_isRunning","emit","bind","_performSync","_handleNewBlockNotification","key","value","getTrackingBlock","getCurrentBlock","_ref","mark","_callee","_this2","wrap","_callee$","_context","prev","next","abrupt","resolve","once","stop","awaitCurrentBlock","apply","_ref2","_callee2","_callee2$","_context2","fromBlock","t0","_fetchBlockByNumber","t1","sent","_setTrackingBlock","t2","_fetchLatestBlock","t3","on","_initSubscription","catch","err","console","error","start","_ref3","_callee3","_callee3$","_context3","_removeSubscription","_ref4","_callee4","newBlock","previous","now","_callee4$","_context4","hash","Date","_warpToLatest","_x3","_ref5","_callee5","oldBlock","_callee5$","_context5","_setCurrentBlock","_x4","_ref6","_callee6","_callee6$","_context6","_ref7","_callee7","_this3","_callee7$","_context7","setTimeout","_pollForNextBlock","_ref8","_callee8","trackingBlock","nextNumber","_callee8$","_context8","number","message","includes","_ref9","_callee9","notification","_callee9$","_context9","id","_subscriptionId","result","_x5","_x6","_ref10","_callee10","_callee10$","_context10","sendAsync","send","jsonrpc","getTime","method","params","_ref11","_callee11","_callee11$","_context11","removeListener","getBlockByNumber","hexNumber","cleanHex","formatHex","module","exports"],"mappings":"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","sourcesContent":["'use strict';\n\nvar _regenerator = require('babel-runtime/regenerator');\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _promise = require('babel-runtime/core-js/promise');\n\nvar _promise2 = _interopRequireDefault(_promise);\n\nvar _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');\n\nvar _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);\n\nvar _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require('babel-runtime/helpers/createClass');\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require('babel-runtime/helpers/inherits');\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// const EthQuery = require('ethjs-query')\nvar EthQuery = require('eth-query');\nvar AsyncEventEmitter = require('async-eventemitter');\nvar pify = require('pify');\nvar hexUtils = require('./hexUtils');\nvar incrementHexNumber = hexUtils.incrementHexNumber;\n\nvar RpcBlockTracker = function (_AsyncEventEmitter) {\n  (0, _inherits3.default)(RpcBlockTracker, _AsyncEventEmitter);\n\n  function RpcBlockTracker() {\n    var opts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    (0, _classCallCheck3.default)(this, RpcBlockTracker);\n\n    var _this = (0, _possibleConstructorReturn3.default)(this, (RpcBlockTracker.__proto__ || (0, _getPrototypeOf2.default)(RpcBlockTracker)).call(this));\n\n    if (!opts.provider) throw new Error('RpcBlockTracker - no provider specified.');\n    _this._provider = opts.provider;\n    _this._query = new EthQuery(opts.provider);\n    // config\n    _this._pollingInterval = opts.pollingInterval || 4e3; // 4 sec\n    _this._syncingTimeout = opts.syncingTimeout || 60 * 1e3; // 1 min\n    // state\n    _this._trackingBlock = null;\n    _this._trackingBlockTimestamp = null;\n    _this._currentBlock = null;\n    _this._isRunning = false;\n    // bind methods for cleaner syntax later\n    _this.emit = _this.emit.bind(_this);\n    _this._performSync = _this._performSync.bind(_this);\n    _this._handleNewBlockNotification = _this._handleNewBlockNotification.bind(_this);\n    return _this;\n  }\n\n  (0, _createClass3.default)(RpcBlockTracker, [{\n    key: 'getTrackingBlock',\n    value: function getTrackingBlock() {\n      return this._trackingBlock;\n    }\n  }, {\n    key: 'getCurrentBlock',\n    value: function getCurrentBlock() {\n      return this._currentBlock;\n    }\n  }, {\n    key: 'awaitCurrentBlock',\n    value: function () {\n      var _ref = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee() {\n        var _this2 = this;\n\n        return _regenerator2.default.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!this._currentBlock) {\n                  _context.next = 2;\n                  break;\n                }\n\n                return _context.abrupt('return', this._currentBlock);\n\n              case 2:\n                _context.next = 4;\n                return new _promise2.default(function (resolve) {\n                  return _this2.once('sync', resolve);\n                });\n\n              case 4:\n                return _context.abrupt('return', this._currentBlock);\n\n              case 5:\n              case 'end':\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function awaitCurrentBlock() {\n        return _ref.apply(this, arguments);\n      }\n\n      return awaitCurrentBlock;\n    }()\n  }, {\n    key: 'start',\n    value: function () {\n      var _ref2 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee2() {\n        var opts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n        return _regenerator2.default.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                if (!this._isRunning) {\n                  _context2.next = 2;\n                  break;\n                }\n\n                return _context2.abrupt('return');\n\n              case 2:\n                this._isRunning = true;\n                // if this._currentBlock\n\n                if (!opts.fromBlock) {\n                  _context2.next = 12;\n                  break;\n                }\n\n                _context2.t0 = this;\n                _context2.next = 7;\n                return this._fetchBlockByNumber(opts.fromBlock);\n\n              case 7:\n                _context2.t1 = _context2.sent;\n                _context2.next = 10;\n                return _context2.t0._setTrackingBlock.call(_context2.t0, _context2.t1);\n\n              case 10:\n                _context2.next = 18;\n                break;\n\n              case 12:\n                _context2.t2 = this;\n                _context2.next = 15;\n                return this._fetchLatestBlock();\n\n              case 15:\n                _context2.t3 = _context2.sent;\n                _context2.next = 18;\n                return _context2.t2._setTrackingBlock.call(_context2.t2, _context2.t3);\n\n              case 18:\n                if (!this._provider.on) {\n                  _context2.next = 23;\n                  break;\n                }\n\n                _context2.next = 21;\n                return this._initSubscription();\n\n              case 21:\n                _context2.next = 24;\n                break;\n\n              case 23:\n                this._performSync().catch(function (err) {\n                  if (err) console.error(err);\n                });\n\n              case 24:\n              case 'end':\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function start() {\n        return _ref2.apply(this, arguments);\n      }\n\n      return start;\n    }()\n  }, {\n    key: 'stop',\n    value: function () {\n      var _ref3 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee3() {\n        return _regenerator2.default.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                this._isRunning = false;\n\n                if (!this._provider.on) {\n                  _context3.next = 4;\n                  break;\n                }\n\n                _context3.next = 4;\n                return this._removeSubscription();\n\n              case 4:\n              case 'end':\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function stop() {\n        return _ref3.apply(this, arguments);\n      }\n\n      return stop;\n    }()\n\n    //\n    // private\n    //\n\n  }, {\n    key: '_setTrackingBlock',\n    value: function () {\n      var _ref4 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee4(newBlock) {\n        var previous, now;\n        return _regenerator2.default.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                if (!(this._trackingBlock && this._trackingBlock.hash === newBlock.hash)) {\n                  _context4.next = 2;\n                  break;\n                }\n\n                return _context4.abrupt('return');\n\n              case 2:\n                // check for large timestamp lapse\n                previous = this._trackingBlockTimestamp;\n                now = Date.now();\n                // check for desynchronization (computer sleep or no internet)\n\n                if (!(previous && now - previous > this._syncingTimeout)) {\n                  _context4.next = 10;\n                  break;\n                }\n\n                this._trackingBlockTimestamp = null;\n                _context4.next = 8;\n                return this._warpToLatest();\n\n              case 8:\n                _context4.next = 14;\n                break;\n\n              case 10:\n                this._trackingBlock = newBlock;\n                this._trackingBlockTimestamp = now;\n                _context4.next = 14;\n                return pify(this.emit)('block', newBlock);\n\n              case 14:\n              case 'end':\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      function _setTrackingBlock(_x3) {\n        return _ref4.apply(this, arguments);\n      }\n\n      return _setTrackingBlock;\n    }()\n  }, {\n    key: '_setCurrentBlock',\n    value: function () {\n      var _ref5 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee5(newBlock) {\n        var oldBlock;\n        return _regenerator2.default.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                if (!(this._currentBlock && this._currentBlock.hash === newBlock.hash)) {\n                  _context5.next = 2;\n                  break;\n                }\n\n                return _context5.abrupt('return');\n\n              case 2:\n                oldBlock = this._currentBlock;\n\n                this._currentBlock = newBlock;\n                _context5.next = 6;\n                return pify(this.emit)('latest', newBlock);\n\n              case 6:\n                _context5.next = 8;\n                return pify(this.emit)('sync', { newBlock: newBlock, oldBlock: oldBlock });\n\n              case 8:\n              case 'end':\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this);\n      }));\n\n      function _setCurrentBlock(_x4) {\n        return _ref5.apply(this, arguments);\n      }\n\n      return _setCurrentBlock;\n    }()\n  }, {\n    key: '_warpToLatest',\n    value: function () {\n      var _ref6 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee6() {\n        return _regenerator2.default.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                _context6.t0 = this;\n                _context6.next = 3;\n                return this._fetchLatestBlock();\n\n              case 3:\n                _context6.t1 = _context6.sent;\n                _context6.next = 6;\n                return _context6.t0._setTrackingBlock.call(_context6.t0, _context6.t1);\n\n              case 6:\n              case 'end':\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this);\n      }));\n\n      function _warpToLatest() {\n        return _ref6.apply(this, arguments);\n      }\n\n      return _warpToLatest;\n    }()\n  }, {\n    key: '_pollForNextBlock',\n    value: function () {\n      var _ref7 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee7() {\n        var _this3 = this;\n\n        return _regenerator2.default.wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                setTimeout(function () {\n                  return _this3._performSync();\n                }, this._pollingInterval);\n\n              case 1:\n              case 'end':\n                return _context7.stop();\n            }\n          }\n        }, _callee7, this);\n      }));\n\n      function _pollForNextBlock() {\n        return _ref7.apply(this, arguments);\n      }\n\n      return _pollForNextBlock;\n    }()\n  }, {\n    key: '_performSync',\n    value: function () {\n      var _ref8 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee8() {\n        var trackingBlock, nextNumber, newBlock;\n        return _regenerator2.default.wrap(function _callee8$(_context8) {\n          while (1) {\n            switch (_context8.prev = _context8.next) {\n              case 0:\n                if (this._isRunning) {\n                  _context8.next = 2;\n                  break;\n                }\n\n                return _context8.abrupt('return');\n\n              case 2:\n                trackingBlock = this.getTrackingBlock();\n\n                if (trackingBlock) {\n                  _context8.next = 5;\n                  break;\n                }\n\n                throw new Error('RpcBlockTracker - tracking block is missing');\n\n              case 5:\n                nextNumber = incrementHexNumber(trackingBlock.number);\n                _context8.prev = 6;\n                _context8.next = 9;\n                return this._fetchBlockByNumber(nextNumber);\n\n              case 9:\n                newBlock = _context8.sent;\n\n                if (!newBlock) {\n                  _context8.next = 16;\n                  break;\n                }\n\n                _context8.next = 13;\n                return this._setTrackingBlock(newBlock);\n\n              case 13:\n                // ask for next block\n                this._performSync();\n                _context8.next = 19;\n                break;\n\n              case 16:\n                _context8.next = 18;\n                return this._setCurrentBlock(trackingBlock);\n\n              case 18:\n                // setup poll for next block\n                this._pollForNextBlock();\n\n              case 19:\n                _context8.next = 31;\n                break;\n\n              case 21:\n                _context8.prev = 21;\n                _context8.t0 = _context8['catch'](6);\n\n                if (!(_context8.t0.message.includes('index out of range') || _context8.t0.message.includes(\"Couldn't find block by reference\"))) {\n                  _context8.next = 29;\n                  break;\n                }\n\n                _context8.next = 26;\n                return this._setCurrentBlock(trackingBlock);\n\n              case 26:\n                // setup poll for next block\n                this._pollForNextBlock();\n                _context8.next = 31;\n                break;\n\n              case 29:\n                console.error(_context8.t0);\n                this._pollForNextBlock();\n\n              case 31:\n              case 'end':\n                return _context8.stop();\n            }\n          }\n        }, _callee8, this, [[6, 21]]);\n      }));\n\n      function _performSync() {\n        return _ref8.apply(this, arguments);\n      }\n\n      return _performSync;\n    }()\n  }, {\n    key: '_handleNewBlockNotification',\n    value: function () {\n      var _ref9 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee9(err, notification) {\n        return _regenerator2.default.wrap(function _callee9$(_context9) {\n          while (1) {\n            switch (_context9.prev = _context9.next) {\n              case 0:\n                if (!(notification.id != this._subscriptionId)) {\n                  _context9.next = 2;\n                  break;\n                }\n\n                return _context9.abrupt('return');\n\n              case 2:\n                if (!err) {\n                  _context9.next = 7;\n                  break;\n                }\n\n                _context9.next = 5;\n                return pify(this.emit)('error', err);\n\n              case 5:\n                _context9.next = 7;\n                return this._removeSubscription();\n\n              case 7:\n                _context9.t0 = this;\n                _context9.next = 10;\n                return this._fetchBlockByNumber(notification.result.number);\n\n              case 10:\n                _context9.t1 = _context9.sent;\n                _context9.next = 13;\n                return _context9.t0._setTrackingBlock.call(_context9.t0, _context9.t1);\n\n              case 13:\n              case 'end':\n                return _context9.stop();\n            }\n          }\n        }, _callee9, this);\n      }));\n\n      function _handleNewBlockNotification(_x5, _x6) {\n        return _ref9.apply(this, arguments);\n      }\n\n      return _handleNewBlockNotification;\n    }()\n  }, {\n    key: '_initSubscription',\n    value: function () {\n      var _ref10 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee10() {\n        var result;\n        return _regenerator2.default.wrap(function _callee10$(_context10) {\n          while (1) {\n            switch (_context10.prev = _context10.next) {\n              case 0:\n                this._provider.on('data', this._handleNewBlockNotification);\n\n                _context10.next = 3;\n                return pify(this._provider.sendAsync || this._provider.send)({\n                  jsonrpc: '2.0',\n                  id: new Date().getTime(),\n                  method: 'eth_subscribe',\n                  params: ['newHeads']\n                });\n\n              case 3:\n                result = _context10.sent;\n\n\n                this._subscriptionId = result.result;\n\n              case 5:\n              case 'end':\n                return _context10.stop();\n            }\n          }\n        }, _callee10, this);\n      }));\n\n      function _initSubscription() {\n        return _ref10.apply(this, arguments);\n      }\n\n      return _initSubscription;\n    }()\n  }, {\n    key: '_removeSubscription',\n    value: function () {\n      var _ref11 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee11() {\n        return _regenerator2.default.wrap(function _callee11$(_context11) {\n          while (1) {\n            switch (_context11.prev = _context11.next) {\n              case 0:\n                if (this._subscriptionId) {\n                  _context11.next = 2;\n                  break;\n                }\n\n                throw new Error(\"Not subscribed.\");\n\n              case 2:\n\n                this._provider.removeListener('data', this._handleNewBlockNotification);\n\n                _context11.next = 5;\n                return pify(this._provider.sendAsync || this._provider.send)({\n                  jsonrpc: '2.0',\n                  id: new Date().getTime(),\n                  method: 'eth_unsubscribe',\n                  params: [this._subscriptionId]\n                });\n\n              case 5:\n\n                delete this._subscriptionId;\n\n              case 6:\n              case 'end':\n                return _context11.stop();\n            }\n          }\n        }, _callee11, this);\n      }));\n\n      function _removeSubscription() {\n        return _ref11.apply(this, arguments);\n      }\n\n      return _removeSubscription;\n    }()\n  }, {\n    key: '_fetchLatestBlock',\n    value: function _fetchLatestBlock() {\n      return pify(this._query.getBlockByNumber).call(this._query, 'latest', true);\n    }\n  }, {\n    key: '_fetchBlockByNumber',\n    value: function _fetchBlockByNumber(hexNumber) {\n      var cleanHex = hexUtils.formatHex(hexNumber);\n      return pify(this._query.getBlockByNumber).call(this._query, cleanHex, true);\n    }\n  }]);\n  return RpcBlockTracker;\n}(AsyncEventEmitter);\n\nmodule.exports = RpcBlockTracker;\n\n// ├─ difficulty: 0x2892ddca\n// ├─ extraData: 0xd983010507846765746887676f312e372e348777696e646f7773\n// ├─ gasLimit: 0x47e7c4\n// ├─ gasUsed: 0x6384\n// ├─ hash: 0xf60903687b1559b9c80f2d935b4c4f468ad95c3076928c432ec34f2ef3d4eec9\n// ├─ logsBloom: 0x00000000000000000000000000000000000000000000000000000000000020000000000000000000000000040000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000\n// ├─ miner: 0x01711853335f857442ef6f349b2467c531731318\n// ├─ mixHash: 0xf0d9bec999600eec92e8e4da8fc1182e357468c9ed2f849aa17e0e900412b352\n// ├─ nonce: 0xd556d5a5504198e4\n// ├─ number: 0x72ac8\n// ├─ parentHash: 0xf5239c3ce1085194521435a5052494c02bbb1002b019684dcf368490ea6208e5\n// ├─ receiptsRoot: 0x78c6f8236094b392bcc43b47b0dc1ce93ecd2875bfb5e4e4c3431e5af698ff99\n// ├─ sha3Uncles: 0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347\n// ├─ size: 0x2ad\n// ├─ stateRoot: 0x0554f145c481df2fa02ecd2da17071672740c3aa948c896f1465e6772f741ac6\n// ├─ timestamp: 0x58955844\n// ├─ totalDifficulty: 0x751d0dfa03c1\n// ├─ transactions\n// │  └─ 0\n// │     ├─ blockHash: 0xf60903687b1559b9c80f2d935b4c4f468ad95c3076928c432ec34f2ef3d4eec9\n// │     ├─ blockNumber: 0x72ac8\n// │     ├─ from: 0x201354729f8d0f8b64e9a0c353c672c6a66b3857\n// │     ├─ gas: 0x15f90\n// │     ├─ gasPrice: 0x4a817c800\n// │     ├─ hash: 0xd5a15d7c2449150db4f74f42a6ca0702150a24c46c5b406a7e1b3e44908ef44d\n// │     ├─ input: 0xe1fa8e849bc10d87fb03c6b0603b05a3e29043c7e0b7c927119576a4bec457e96c7d7cde\n// │     ├─ nonce: 0x323e\n// │     ├─ to: 0xd10e3be2bc8f959bc8c41cf65f60de721cf89adf\n// │     ├─ transactionIndex: 0x0\n// │     ├─ value: 0x0\n// │     ├─ v: 0x29\n// │     ├─ r: 0xf35f8ab241e6bb3ccaffd21b268dbfc7fcb5df1c1fb83ee5306207e4a1a3e954\n// │     └─ s: 0x1610cdac2782c91065fd43584cd8974f7f3b4e6d46a2aafe7b101788285bf3f2\n// ├─ transactionsRoot: 0xb090c32d840dec1e9752719f21bbae4a73e58333aecb89bc3b8ed559fb2712a3\n// └─ uncles"]},"metadata":{},"sourceType":"script"}